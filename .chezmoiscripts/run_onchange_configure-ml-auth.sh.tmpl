#!/bin/bash

# This script runs whenever AI/ML CLI auth changes
# Hash: ai-ml-cli-auth-v1

{{ if eq .chezmoi.os "linux" -}}

set -e

echo "üîê Checking AI/ML CLI authentication status..."

#################
# GitHub CLI
#################
if command -v gh >/dev/null 2>&1; then
    if gh auth status >/dev/null 2>&1; then
        echo "‚úÖ GitHub CLI is authenticated"
    else
        echo "‚ö†Ô∏è  GitHub CLI not authenticated. Run: gh auth login"
    fi
fi

#################
# Hugging Face CLI
#################
if command -v hf >/dev/null 2>&1; then
    if hf auth whoami >/dev/null 2>&1; then
        echo "‚úÖ Hugging Face CLI is authenticated"
    else
        echo "‚ö†Ô∏è  Hugging Face CLI not authenticated. Run: hf auth login"
    fi
fi

#################
# wandb
#################
if command -v wandb >/dev/null 2>&1; then
    # Check wandb config file instead of using 'wandb verify' (which can be unreliable)
    if [ -f ~/.netrc ] && grep -q "api.wandb.ai" ~/.netrc 2>/dev/null; then
        echo "‚úÖ wandb is authenticated"
    elif [ -f ~/.config/wandb/settings ] && grep -q "api_key" ~/.config/wandb/settings 2>/dev/null; then
        echo "‚úÖ wandb is authenticated"
    else
        echo "‚ö†Ô∏è  wandb not authenticated. Run: wandb login"
    fi
fi

echo ""
echo "üìù To authenticate, run:"
echo "   gh auth login      # GitHub"
echo "   hf auth login      # Hugging Face"
echo "   wandb login        # Weights & Biases"
echo ""

{{ end -}}
