#!/usr/bin/env bash
# Install nvitop - an interactive NVIDIA GPU process viewer
# This script runs once after chezmoi apply

set -euo pipefail

echo "Installing nvitop..."

# Check if uv is installed
if ! command -v uv &> /dev/null; then
    echo "Error: uv is not installed. Please install uv first."
    exit 1
fi

# Install nvitop using uv tool
# This installs it globally in ~/.local/bin
if ! command -v nvitop &> /dev/null; then
    echo "Installing nvitop via uv tool..."
    uv tool install nvitop
    echo "✓ nvitop installed successfully"
else
    echo "✓ nvitop is already installed"
    # Optionally upgrade to latest version
    echo "Upgrading nvitop to latest version..."
    uv tool upgrade nvitop || true
fi

echo "Done! You can now use 'nvitop' command."

